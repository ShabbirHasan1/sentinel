#!/usr/bin/env bash
#MISE description="Serve the mdBook documentation with live reload"
#MISE depends=["book-build"]
#MISE env={PORT="3000", OPEN_BROWSER="true"}

set -e

# Colors for output
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

cd "$(dirname "$0")/../.." # Navigate to project root

echo -e "${BLUE}Starting Sentinel documentation server...${NC}"

# Check if mdbook exists
if ! command -v mdbook &> /dev/null; then
    echo -e "${RED}Error: mdBook is not installed${NC}"
    echo -e "${YELLOW}Run 'mise run book-install' to install mdBook${NC}"
    exit 1
fi

# Set default port if not specified
PORT=${PORT:-3000}
OPEN_BROWSER=${OPEN_BROWSER:-true}

# Build open browser flag
OPEN_FLAG=""
if [[ "$OPEN_BROWSER" == "true" ]]; then
    OPEN_FLAG="--open"
fi

echo -e "${GREEN}âœ“ Starting documentation server${NC}"
echo -e "${YELLOW}  URL: http://localhost:${PORT}${NC}"
echo -e "${YELLOW}  Live reload: Enabled${NC}"
echo -e "${YELLOW}  Auto-open browser: ${OPEN_BROWSER}${NC}"
echo -e "${BLUE}  Press Ctrl+C to stop${NC}"
echo

# Navigate to book directory and serve
cd book
exec mdbook serve --port "${PORT}" ${OPEN_FLAG}
