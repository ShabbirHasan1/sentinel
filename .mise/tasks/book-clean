#!/usr/bin/env bash
#MISE description="Clean mdBook build artifacts"

set -e

# Colors for output
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

cd "$(dirname "$0")/../.." # Navigate to project root

echo -e "${YELLOW}Cleaning mdBook build artifacts...${NC}"

# Navigate to book directory
cd book

# Remove build output directory
if [ -d "book" ]; then
    rm -rf book
    echo -e "${GREEN}✓ Removed build directory: book/book/${NC}"
else
    echo -e "${BLUE}  Build directory doesn't exist, nothing to clean${NC}"
fi

# Remove any backup files
BACKUP_COUNT=0
for pattern in "*.bak" "*.swp" "*~" "*.tmp" "*.temp"; do
    FILES=$(find . -name "$pattern" -type f 2>/dev/null)
    if [ -n "$FILES" ]; then
        echo "$FILES" | while read -r file; do
            rm -f "$file"
            ((BACKUP_COUNT++))
        done
    fi
done

if [ $BACKUP_COUNT -gt 0 ]; then
    echo -e "${GREEN}✓ Removed ${BACKUP_COUNT} backup/temporary files${NC}"
fi

# Remove .DS_Store files on macOS
if [[ "$OSTYPE" == "darwin"* ]]; then
    find . -name ".DS_Store" -type f -delete 2>/dev/null || true
    echo -e "${GREEN}✓ Removed .DS_Store files${NC}"
fi

echo -e "${GREEN}✓ Clean complete${NC}"
